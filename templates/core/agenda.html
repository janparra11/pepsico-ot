{% extends "base.html" %}
{% block title %}Agenda{% endblock %}
{% block content %}
<div class="bg-white p-4 rounded shadow-sm">
  <h1 class="h5 mb-3">Agenda</h1>
  <div id="calendar"></div>
</div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales-all.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const el = document.getElementById('calendar');
  const calendar = new FullCalendar.Calendar(el, {
    initialView: 'dayGridMonth',
    locale: 'es', // ðŸ‘ˆ idioma espaÃ±ol
    timeZone: 'local',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay'
    },
    buttonText: {
      today: 'Hoy',
      month: 'Mes',
      week: 'Semana',
      day: 'DÃ­a'
    },
    events: '{% url "core_agenda_api" %}',

    eventClick: function(info) {
    info.jsEvent.preventDefault();     // evita cualquier click por defecto
    if (info.event.url) {
        window.location.href = info.event.url;  // abre solo si hay URL vÃ¡lida
    }
    },


    // ðŸ‘‡ habilitamos agregar eventos manuales
    selectable: true,
    select: function(selectionInfo) {
    const titulo = prompt("TÃ­tulo del evento:");
    if (titulo) {
        fetch("{% url 'core_agenda_crear_api' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({
            titulo: titulo,
            inicio: selectionInfo.startStr,
            fin: selectionInfo.endStr
        })
        })
        .then(r => r.json())
        .then(() => {
        calendar.refetchEvents(); // recarga sin mostrar nada
        });
    }
    calendar.unselect();
    }
  });
  calendar.render();
});
</script>
{% endblock %}
